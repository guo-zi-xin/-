# 技术选型

##起因
在2015年1月1日，我选择了AngularJS 1.x作为我实施新项目的前端开发框架。确定使用AngularJS的主要原因其实很简单，刚好符合我的技术构想而已。

我之前的工作经验，并未包含任何的web开发工作，只是单纯的移动互联网C/S结构。而AngularJS满足了我在web端仍然使用此结构制作基于浏览器的客户端。

###当时的技术结构

```
在分析phalcon和AngularJS之前，我想先尽量将其他方面的的内容整理出来。因为这些内容都是我过去工作经历的一些经验。
```

* Web端
    * 使用AngularJS构建
    * 部署在阿里云OSS上（纯静态html）
* Server端
    * 使用Phalcon构建（基于php）
    * 部署在阿里云ECS上
    * 数据库使用阿里云RDS
* 通讯协议
    * 使用http默认方式通讯（使用https加密）
    * 使用基于json构建的通讯协议和通讯包
* 源码管理
    * 使用gitlab的开源版本
    * 部署在独立的阿里云ECS上
* 工具链
    * WebStorm      用于web开发
    * PhpStorm      用于php开发
    * SourceTree    用于源代码管理
    * OS X Server   用于本地php运行调试环境
    * Chrome        开发者工具调试、网络搜索资料

####针对以上技术选型的分析


**阿里云 aliyun.com**

阿里云目前是我租用网络服务器的首选，因为已经有3年多的使用经验。我总结阿里云的优势如下：

```
注：以下主要都是根据我2012-2013年时进行服务器部署方案选择时的经验总结而成。由于一直使用阿里云服务且并未遇到不可克服的问题，因此也未再去了解其他的新技术和方案。
```

1. 快速稳定
    * 可快速的按需购买并部署，一般几分钟即可完成整个流程。
    * 在整个使用过程中，未出现过网络中断或服务器宕机的问题。
2. 成本低廉
    * 租用阿里云的服务器的成本，相较购买部署实体服务器而言要低很多。从运营角度而言，此成本可忽略不计（对比人力成本）。
3. 交流方便
    * 后台发起工单后阿里云会在几分钟内处理完毕。
    * 阿里云工作人员多次上门拜访，并听取了我的意见和建议。
4. 自动备份
    * 数据库的自动备份和回档，让我在运营阶段省心很多。
    * 另外在一些核心逻辑和数据出错之后，做紧急回档的效率也比较高。
5. 支付方便
    * 绑定了公司的支付宝账号，直接支付非常便捷。


**gitlab**

我所在的团队基本都一直使用git作为源码管理工具（早年使用过svn，但很快就切换到了git）。最开始，我们使用的是不带web界面的git服务器系统，然后另外建立了Bug追踪管理系统（如bugfree等）。但团队仍然为git的权限管理头疼。

因此，我尝试部署了gitlab系统，之后就一直使用它了。我总结gitlab的优势如下：

* 简单直观的web界面
    * 在gitlab里面浏览项目，和在github上一样简单直观
* 完整且便捷的权限管理
    * 可详细的配置各个用户针对各个项目的权限
* 超便捷的issue系统
    * 在gitlab里面建立的issue/bug，可以快速指派给其他人
    * 这也是我喜欢gitlab的__核心原因__之一，极大提高了技术和测试团队的协作效率
    * issue系统支持markdown语言，这也是我在wiki之后真正仔细的学习和使用markdown的地方
* web merge功能
    * 在网页上进行merge的对比和确认（此项工作让代码review变成了真正可操作且必操作的任务）
* web hook功能
    * 通过此项功能，我们实现了针对公网运营服务器的一次性统一自动升级功能

当然，gitlab也有他的缺陷所在，就是部署它需要的硬件实在是太高了。由于gitlab使用ruby & rails制作，官网上当时推荐的运行环境要求是8-16GB内存。根据我的尝试，在1-2GB内存的服务器上，编译安装会很困难，即使安装成功，运行一段时间后，也会出现gitlab进程挂掉的情况。但是在4GB内存的阿里云服务器上，gitlab可以稳定运行。

```
小窍门：部署好gitlab之后，这台服务器仍然可以挪作他用，比如跑php的测试环境之类的。不会影响到gitlab的稳定运行。
```


**通讯协议**

使用http是因为实现最为便捷，并可利用nginx，php-fpm等的优化，以及阿里云的负载均衡等服务，快速的横向扩展，来提高架构的承载能力。

包体结构使用的非常基础的设计：

```json
访问包体 Request:
{
    "c":"controller", //controller名称
    "a":"action", //action行为名称
    "s":"session", //访问session
    "d":{
        //data_package 上传数据
    }
}

回复包体 Response:
{
    "c":200, //返回码，200=ok
    "d":{
        //data_package 返回数据 if(c==200)
    },
    "m":{
        //错误信息 if(c!=200)
    }
}
```

从目前角度而言，网络服务的包体结构设计满足需求即可。其他方面的考量（如包体大小等），已经不足以成为影响包体结构设计的因素。
